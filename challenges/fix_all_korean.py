#!/usr/bin/env python3
"""
깨진 한글 전체 수정 스크립트
"""

import re

def fix_korean_text(text):
    """깨진 한글 패턴을 올바른 텍스트로 교체"""

    # 자주 나오는 깨진 패턴을 올바른 텍스트로 매핑
    replacements = {
        # 조사/어미
        '?�': '',  # 깨진 문자 제거
        '?��?': '을',
        '?�를': '를',
        '?�는': '는',
        '?�이': '이',
        '?�가': '가',
        '?�에': '에',
        '?�서': '서',
        '?�고': '고',
        '?�다': '다',
        '?�요': '요',
        '?�니??': '니다',
        '?�세??': '세요',
        '?�습?�다': '습니다',

        # 자주 나오는 단어들
        '?�그': '태그',
        '?�용': '사용',
        '?�성': '작성',
        '?�션': '섹션',
        '?�목': '제목',
        '?�이지': '페이지',
        '?�언': '선언',
        '?�정': '설정',
        '?�입': '삽입',
        '?�시': '표시',
        '?�백': '폴백',
        '?�벨': '레벨',
        '?�인': '라인',
        '?�크': '링크',
        '?�스트': '텍스트',
        '?�레?�어': '플레이어',
        '?�맷': '포맷',
        '?�트': '아트',
        '?�이?�그': '다이어그램',
        '콘텐�?': '콘텐츠',
        '구분??': '구분선',
        '?�평??': '수평선',
        '문단': '문단',
        '?��?지': '이미지',
        '비디??': '비디오',
        '?�디??': '오디오',
        '?�베??': '임베드',
        '반응??': '반응형',
        '?�백': '폴백',
        '계층': '계층',
        '?�러': '여러',
        '??': '두',
        '가??': '가장',
        '줄바�?': '줄바꿈',
        '?�코??': '인코딩',
        '뷰포??': '뷰포트',
        '메�?': '메타',
        '주석': '주석',
        '?�수': '필수',
        '?�택': '선택',
        '?�공': '제공',
        '지??': '지원',
        '경험': '경험',
        '?�중': '신중',
        '??�?': '제목',
        '브라?��?': '브라우저',
        '?�동': '자동',
        '?�아??': '아래',
        '만듭??': '만듭니다',
        '감쌉??': '감쌉니다',
        '?�나??': '하나만',
        '부??': '부터',
        '까�?': '까지',
        '?�으�?': '갈수록',
        '?�자': '숫자',
        '?�수�?': '작습니다',
        '좋습??': '좋습니다',
        '?�치??': '위치합니다',
        '?�는': '닫는',
        '?�습??': '없습니다',
        '추�?': '추가',
        '캡션': '캡션',
        '구조': '구조',
        '기본': '기본',
        '?�라': '따라',
        '?�른': '다른',
        '보여주세??': '보여주세요',
        '?�환': '변환',
        '반응???��?지': '반응형 이미지',
        '?�졌습다': '졌습니다',
        '?�두': '하도록',
        '?�?니두': '합니다',
        '?�?을': '하세요',
        '?�?으�?': '하도록',
        '?�?도': '해도',
        '깨�?지': '깨지지',
        '유��다': '유용합니다',
        '?�/': '확대/',
        '목록두': '목록으로',
        '소': '소개',
        '시세두': '하세요',
        '입두스�?': '입니다',
        '시니두': '합니다',
        '링크가 니두': '링크가 됩니다',
        '밑줄�?': '밑줄을',
        '평두': '수평선',
        '그': '태그',
        '두': '를',
        '�?': '를',
        '의': '의',
        '지': '지',
        '이': '이',
        '에': '에',
        '가': '가',
        '는': '는',
        '로': '로',
        '세': '세요',
        '다': '다',
        '니': '니다',
        '요': '요',
    }

    result = text
    for old, new in replacements.items():
        result = result.replace(old, new)

    return result

def main():
    input_file = 'ALL-CHALLENGES-COMBINED.sql'
    output_file = 'ALL-CHALLENGES-FIXED.sql'

    print(f"Reading {input_file}...")
    with open(input_file, 'r', encoding='utf-8', errors='replace') as f:
        content = f.read()

    print("Fixing Korean text...")
    fixed_content = fix_korean_text(content)

    print(f"Writing to {output_file}...")
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(fixed_content)

    # 통계
    original_broken = content.count('?�')
    fixed_broken = fixed_content.count('?�')

    print(f"\nOriginal broken characters: {original_broken}")
    print(f"Remaining broken characters: {fixed_broken}")
    print(f"Fixed: {original_broken - fixed_broken}")
    print(f"\nDone! Use {output_file}")

if __name__ == "__main__":
    main()
